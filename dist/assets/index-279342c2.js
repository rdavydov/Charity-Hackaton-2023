var C=Object.defineProperty;var B=(o,e,t)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var w=(o,e,t)=>(B(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();class E{constructor(e){w(this,"log",[]);this.board=e,this.movesCounter=0}findItem(e=0){for(let t=0;t<this.board.length;t++)for(let n=0;n<this.board.length;n++)if(this.board[t][n]===e)return[t,n]}randomize(e){this.movesCounter=0,this.board=[];for(let n=0;n<e;n++){const r=[];for(let s=0;s<e;s++){const a=e*n+s+1;r.push(a===e*e?0:a)}this.board.push(r)}let t=0;for(let n=0;n<1e3;n++){let r=Math.floor(Math.random()*4),s=!1;switch(r){case 0:s=this.up();break;case 1:s=this.left();break;case 2:s=this.down();break;case 3:s=this.right()}if(s&&t++,t===10)return}}up(){const e=this.findItem();return e[0]>0?(this.applyMove({from:e,to:[e[0]-1,e[1]]}),!0):!1}down(){const e=this.findItem();return e[0]<this.board.length-1?(this.applyMove({from:e,to:[e[0]+1,e[1]]}),!0):!1}right(){const e=this.findItem();return e[1]<this.board.length-1?(this.applyMove({from:e,to:[e[0],e[1]+1]}),!0):!1}left(){const e=this.findItem();return e[1]>0?(this.applyMove({from:e,to:[e[0],e[1]-1]}),!0):!1}rollback(){if(this.log.length===0||this.isFinished())return null;let e=this.log.pop();const t=this.board[e.to[0]][e.to[1]];let n={from:e.to,to:e.from};return this.applyMove(n),this.movesCounter++,{item:t,movesCount:this.log.length,direction:this.calculateDirection(n.from,n.to)}}isFinished(){const e=this.board.flat();for(let t=0;t<e.length-1;t++)if(t+1!==e[t])return!1;return!0}applyMove(e){const t=e.from[0],n=e.from[1],r=e.to[0],s=e.to[1];let a=this.board[r][s];this.board[r][s]=this.board[t][n],this.board[t][n]=a}calculateDirection(e,t){if(e[0]<t[0])return"down";if(e[0]>t[0])return"up";if(e[1]<t[1])return"right";if(e[1]>t[1])return"left"}getMoveDown(){const e=this.findItem(0);return e[0]<1?null:this.board[e[0]-1][e[1]]}getMoveUp(){const e=this.findItem(0);return e[0]>=this.board.length-1?null:this.board[e[0]+1][e[1]]}getMoveRight(){const e=this.findItem(0);return e[1]<1?null:this.board[e[0]][e[1]-1]}getMoveLeft(){const e=this.findItem(0);return e[1]>=this.board.length-1?null:this.board[e[0]][e[1]+1]}move(e){if(this.isFinished())return null;const t=this.findItem(e),n=t[0],r=t[1],s=this.board[n][r];let a={from:[n,r],to:[]};const b=this.board[n][r-1],g=this.board[n][r+1],v=n>0?this.board[n-1][r]:void 0,y=n<this.board.length-1?this.board[n+1][r]:void 0;return b===0&&(a.to=[n,r-1]),g===0&&(a.to=[n,r+1]),v===0&&(a.to=[n-1,r]),y===0&&(a.to=[n+1,r]),v!==0&&y!==0&&g!==0&&b!==0?null:(this.applyMove(a),this.log.push(a),this.movesCounter++,{card:s,finished:this.isFinished(),direction:this.calculateDirection(a.from,a.to)})}}const k={apiKey:"AIzaSyBf87YKzUCb2LJhxV1_SZKFtF9YvKV5YAg",authDomain:"slider-game-database.firebaseapp.com",databaseURL:"https://slider-game-database-default-rtdb.firebaseio.com",projectId:"slider-game-database",storageBucket:"slider-game-database.appspot.com",messagingSenderId:"99994989759",appId:"1:99994989759:web:acb79d25a1d12fefea420a"};firebase.initializeApp(k);const $=firebase.database().ref("usersData"),S=o=>{$.push().set(o)},T=()=>new Promise((o,e)=>{const t=[];firebase.database().ref("usersData").once("value").then(function(r){const s=r.val();for(const a in s)t.push({name:s[a].name,time:s[a].time});o(t)}).catch(r=>{e(r)})}),A=o=>{const e=document.querySelector("#tbody");e.innerHTML="";for(let t=0;t<7&&t<o.length;t++){const n=o[t],r=e.insertRow();r.insertCell(0).textContent=t+1,r.insertCell(1).textContent=n.name,r.insertCell(2).textContent=n.time}},F=()=>{T().then(o=>{const e=o.sort((t,n)=>{const r=D(t.time),s=D(n.time);return r-s});A(e)}).catch(o=>{console.error("Error getting users list:",o)})},D=o=>{const[e,t]=o.split(":").map(Number);return e*60+t},I=document.getElementById("start-game-button"),f=document.getElementById("game-board"),q=document.getElementById("undo-button"),h=document.getElementById("moves-counter"),U=document.querySelectorAll(".js-board-size"),p=document.getElementById("win-dialog"),x=document.getElementById("user-name-form"),L=document.getElementById("user-name-input"),H=document.getElementById("cancel-button"),O=document.getElementById("show-leaderboard"),K=document.getElementById("leaderboard"),l=new E([]),i={};let c=4;U.forEach(o=>{o.addEventListener("change",()=>{o.checked===!0&&(c=o.value)})});const u={name:null,time:null,moves:null},M=()=>{document.querySelector(".timer").textContent=u.time};let m;const N=(o=!1)=>{let e=o?new Date:new Date;const t=()=>{const r=Math.floor((new Date-e)/1e3);u.time=`${Math.floor(r/60)}:${r%60<10?"0":""}${r%60}`,M()};clearInterval(m),m=setInterval(t,1e3)},d=o=>{if(o===null)return;const e=l.move(o),t=f.querySelector(`[data-item="${o}"]`);if(e.finished&&(clearInterval(m),setTimeout(()=>{p.showModal()},700)),e!==null){switch(e.direction){case"left":i[o][0]-=100;break;case"right":i[o][0]+=100;break;case"up":i[o][1]-=100;break;case"down":i[o][1]+=100;break}t.style.transform=`translate(${i[o][0]}%,${i[o][1]}%)`,h.innerHTML=l.movesCounter}};I.addEventListener("click",()=>{u.time="0:00",M(),N(!0),l.randomize(c),h.innerHTML=l.movesCounter;const o=l.board.flat(),e=`cell-${c}x${c}`;let t=[];I.innerHTML="Заново",o.forEach(n=>{let r=n===0?"":`<img data-item="${n}" src="photo/${c}/${n}.jpg" alt="">`;t.push(`<div class="cell ${e}"><div class="image-wrapper">`+r+"</div></div>"),i[n]=[0,0]}),f.innerHTML=t.join(""),f.querySelectorAll("img").forEach(n=>{n.addEventListener("click",()=>{const r=parseInt(n.dataset.item);d(r)})})});q.addEventListener("click",()=>{const o=l.rollback();if(o===null)return;const e=o.item;switch(o.direction){case"left":i[e][0]-=100;break;case"right":i[e][0]+=100;break;case"up":i[e][1]-=100;break;case"down":i[e][1]+=100;break}const t=f.querySelector(`[data-item="${e}"]`);t.style.transform=`translate(${i[e][0]}%,${i[e][1]}%)`,h.innerHTML=l.movesCounter});x.addEventListener("submit",o=>{o.preventDefault(),u.name=L.value??"Аноним",S(u),p.close(),L.value=""});H.addEventListener("click",()=>{p.close()});O.addEventListener("click",()=>{F(),K.style.opacity="1"});document.addEventListener("keydown",o=>{o.key==="ArrowDown"&&(o.preventDefault(),d(l.getMoveDown())),o.key==="ArrowUp"&&(o.preventDefault(),d(l.getMoveUp())),o.key==="ArrowLeft"&&(o.preventDefault(),d(l.getMoveLeft())),o.key==="ArrowRight"&&(o.preventDefault(),d(l.getMoveRight()))});
